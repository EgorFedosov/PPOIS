# Система учёта книжного фонда (PyQt6, MVC)

## Назначение
Приложение предназначено для ведения книжного фонда: хранения, просмотра, поиска, удаления записей и обмена данными через XML.

Карточка книги содержит:
- название книги;
- ФИО автора;
- издательство;
- число томов;
- тираж;
- вычисляемое поле `Итого томов` (`volumes * circulation`).

## Стек технологий
- Язык: Python 3.10+
- GUI: PyQt6
- База данных: SQLite (через Qt SQL драйвер `QSQLITE`)
- XML запись: `xml.dom.minidom` (DOM)
- XML чтение: `xml.sax` (SAX)
- Архитектура: MVC (разделение на `models/`, `views/`, `controllers/`)

## Архитектура и структура проекта
- `main.py`  
  Точка входа: инициализация `QApplication`, окна, менеджера БД и контроллера.

- `models/book_model.py`  
  Модель данных (`Book`), критерии фильтрации (`QueryCriteria`), построение `WHERE`-условий для SQL.

- `models/database.py`  
  Работа с БД: создание схемы, чтение, массовая замена данных, удаление по критериям, переключение файла БД.

- `models/xml_handlers.py`  
  Экспорт XML через DOM и импорт XML через SAX.

- `models/proxy_models.py`  
  Прокси-модели для фильтрации (`BooksFilterProxyModel`) и пагинации (`PagingProxyModel`).

- `views/main_window.py`  
  Главное окно: меню, тулбар, `QTableView`, `QTreeView`, панель пагинации.

- `views/dialogs.py`  
  Диалоги: добавление записи, поиск, удаление.

- `controllers/app_controller.py`  
  Связь UI и модели: обработка действий меню/кнопок, синхронизация представлений, операции с БД/XML.

## Отчёт по разработанной системе

### 1. Реализованные возможности
- Добавление записи о книге через диалог ввода с проверкой обязательных полей.
- Просмотр данных в табличном представлении (`QTableView`).
- Альтернативный просмотр в древовидном виде (`QTreeView`).
- Поиск по нескольким критериям:
  - автор;
  - издательство;
  - название;
  - диапазон числа томов;
  - тираж (`>` / `<`);
  - итоговое число томов (`>` / `<`).
- Удаление записей по тем же критериям.
- Пагинация (первая/предыдущая/следующая/последняя страница + выбор размера страницы).
- Экспорт текущих данных в XML.
- Импорт данных из XML с полной заменой содержимого таблицы.
- Выбор/переключение файла базы данных SQLite.

### 2. Логика данных
- Поле `total_tomes` хранится в таблице БД.
- При изменении исходных полей (`volumes`, `circulation`) значение `total_tomes` поддерживается на уровне БД.
- Импорт XML выполняется атомарно (в транзакции): либо загружаются все записи, либо изменения откатываются.

### 3. Организация MVC
- `Model`: доступ к данным (БД + XML), бизнес-правила фильтрации.
- `View`: главное окно и диалоги без прямой бизнес-логики.
- `Controller`: реакция на UI-события, вызов операций модели, обновление представления.

## Сценарии демонстрации системы

### Сценарий 1. Запуск и просмотр данных
1. Запустить приложение: `python main.py`.
2. Убедиться, что отображается главное окно с меню и тулбаром.
3. Проверить отображение записей в таблице.
4. Переключиться в вид дерева и обратно.

### Сценарий 2. Добавление записи
1. Нажать «Добавить запись».
2. Ввести название, автора, издательство, число томов и тираж.
3. Подтвердить ввод.
4. Проверить появление новой записи в таблице и дереве.

### Сценарий 3. Поиск записей
1. Открыть диалог «Поиск».
2. Задать одно или несколько условий (например, автор + диапазон томов).
3. Нажать «Найти».
4. Проверить, что в мини-таблице отображаются только подходящие записи.
5. Проверить пагинацию внутри диалога поиска.
6. Нажать «Сбросить фильтр» и убедиться, что снова видны все записи.

### Сценарий 4. Удаление по критериям
1. Открыть диалог «Удаление».
2. Задать критерий (например, `тираж < 1000`).
3. Подтвердить удаление.
4. Проверить информационное сообщение с количеством удалённых записей.
5. Проверить обновление таблицы, дерева и пагинации.

### Сценарий 5. Экспорт и импорт XML
1. Нажать «Сохранить XML» и выбрать путь.
2. Убедиться, что файл XML создан.
3. Нажать «Загрузить XML» и выбрать файл.
4. Проверить, что данные в таблице заменены содержимым XML.

### Сценарий 6. Пагинация
1. Изменить значение «на странице».
2. Перейти на следующую/последнюю страницу.
3. Проверить корректность счётчиков:
   - «Страница X из Y»;
   - «Записей на странице / Всего записей».

### Сценарий 7. Работа с разными БД
1. Выбрать пункт «Выбрать БД».
2. Указать новый файл `.db`.
3. Проверить создание структуры таблиц и загрузку данных выбранной БД.

## Подготовленные данные
- `data/books_sample_1.xml`
- `data/books_sample_2.xml`

Оба файла можно использовать для демонстрации импорта и поиска/удаления.

## Запуск проекта
1. Установить зависимости:
   `python -m pip install -r requirements.txt`
2. Запустить приложение:
   `python main.py`
